
<!DOCTYPE html>

<html class="no-js" lang="nl">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Documentation of wireless communications" name="description"/>
<meta content="Ruben Smit (423723), Willem Dekker (436608)" name="author"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.1.2, mkdocs-material-7.1.0" name="generator"/>
<title>LED app - Wireless communications</title>
<link href="../assets/stylesheets/main.33e2939f.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.ef6f36e2.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
</head>
<body data-md-color-accent="" data-md-color-primary="" data-md-color-scheme="default" dir="ltr">
<script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
<script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#led-app">
          Ga naar inhoud
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Wireless communications" class="md-header__button md-logo" data-md-component="logo" href=".." title="Wireless communications">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Wireless communications
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              LED app
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"></path></svg>
</label>
<input class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Zoeken" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Zoeken" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/RubenSmit/wireless-communication" title="Ga naar repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    RubenSmit/wireless-communication
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Wireless communications" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Wireless communications">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"></path></svg>
</a>
    Wireless communications
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/RubenSmit/wireless-communication" title="Ga naar repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    RubenSmit/wireless-communication
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
        Introduction
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../system-documentation/">
        High level Radio
      </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3">
        Low level radio
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Low level radio" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Low level radio
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../theory/">
        Theory
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          LED app
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        LED app
      </a>
<nav aria-label="Inhoudsopgave" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Inhoudsopgave
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#pinout-and-functions-of-nrf24l01">
    Pinout and functions of NRF24L01
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#packet-definition">
    Packet definition
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#communication-between-the-boards">
    Communication between the boards
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#implementation">
    Implementation
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../per-app/">
        PER app
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../throughput-test-app/">
        Throughput test app
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Inhoudsopgave" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Inhoudsopgave
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#pinout-and-functions-of-nrf24l01">
    Pinout and functions of NRF24L01
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#packet-definition">
    Packet definition
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#communication-between-the-boards">
    Communication between the boards
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#implementation">
    Implementation
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="led-app">Led App</h1>
<p>In this chapter we walk about the design and implementation of the led app.</p>
<h2 id="pinout-and-functions-of-nrf24l01">Pinout and functions of NRF24L01</h2>
<table>
<thead>
<tr>
<th>PIN number</th>
<th>Arduino connection</th>
<th>function</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>GND</td>
<td>GND: this provides the ground to the nrf this is needed so the reference voltage for the control signals is known</td>
</tr>
<tr>
<td>2</td>
<td>Ioref</td>
<td>VCC: This is providing the power to the chip for it to turn on this needs to be 3.3V</td>
</tr>
<tr>
<td>3</td>
<td>D9</td>
<td>CE: Chip enable is the pin that manages whether the chip should listen to the SPI commands send</td>
</tr>
<tr>
<td>4</td>
<td>D10</td>
<td>CSN: is the chip select not pin this pin is used to enable the spi bus</td>
</tr>
<tr>
<td>5</td>
<td>D13</td>
<td>SCK: Serial clock provides the clock pulse for the spi communication to work</td>
</tr>
<tr>
<td>6</td>
<td>D11</td>
<td>MOSI: Master out slave in pin this is the input pin for data from the microcontroller to the NRF</td>
</tr>
<tr>
<td>7</td>
<td>D12</td>
<td>MISO: Master in slave out pin this is the output pin for data drom the nrf to the microcontroller</td>
</tr>
<tr>
<td>8</td>
<td>D7</td>
<td>IRQ: This is the inrerrupt pin an wil be active low when triggerd</td>
</tr>
</tbody>
</table>
<h2 id="packet-definition">Packet definition</h2>
<p>The data that needs to be transported between the two radio's is the following:
should i go to the next pin, should i go the previous pin, and what pin am I on?
This data can be fit into 3 variables so 3 bytes. The packet would look
something like this:</p>
<table>
<thead>
<tr>
<th></th>
<th>Next</th>
<th>previus</th>
<th>current pin</th>
</tr>
</thead>
<tbody>
<tr>
<td>Packet data</td>
<td>0x00</td>
<td>0x01</td>
<td>0x01</td>
</tr>
<tr>
<td>Values</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>So, this packet tells you need to go back one pin and the current pin is 1. So, a packet containing 0x010003 would be go to next pin current pin is 3. This way the minimal amount of data is send over the air.</p>
<h2 id="communication-between-the-boards">Communication between the boards</h2>
<p>The boards would send a package described above to the other board and increment or decretent the pointer value
given in the packet this packet would sync the boards if there was a discrepancy between them. This is shown in the picture below.</p>
<p><img alt="Diagram for packet flow" src="../img/packet-flow-led-app.png"/></p>
<h2 id="implementation">Implementation</h2>
<p>During the implementation of this project, we stumbled on a few roadblocks. The code that was provided in the assignment was out of date and would not compile a few days where spend on trying to get this code to work and we did not get it running. We have tried platformIO to compile it the browser-based IDE and their own IDE but the sample code did not work. Then we tried working with the MCP23508 and while we could get LEDs to light up. After a few nights work we did not get the interrupts working not on the Nucleo or on a Arduino UNO which was used for sanity checking our way of thinking. We even after consulting the documentation of the MCP we did not get it to work. We beleave  some adress asighment did not go right or wat not interperted right. The configuration was:</p>
<table>
<thead>
<tr>
<th>Register</th>
<th>Address</th>
<th>Value</th>
<th>binary</th>
</tr>
</thead>
<tbody>
<tr>
<td>IODIR</td>
<td>0x00</td>
<td>0xc0</td>
<td>1100 0000</td>
</tr>
<tr>
<td>IPOL</td>
<td>0x01</td>
<td>0x00</td>
<td>0000 0000</td>
</tr>
<tr>
<td>GPINTEN</td>
<td>0x02</td>
<td>0xc0</td>
<td>1100 0000</td>
</tr>
<tr>
<td>DEFVAL</td>
<td>0x03</td>
<td>0xc0</td>
<td>1100 0000</td>
</tr>
<tr>
<td>INTCON</td>
<td>0x04</td>
<td>0xc0</td>
<td>1100 0000</td>
</tr>
<tr>
<td>IOCON</td>
<td>0x05</td>
<td>0x0A</td>
<td>0000 1010</td>
</tr>
<tr>
<td>GPPU</td>
<td>0x06</td>
<td>0xC0</td>
<td>1100 0000</td>
</tr>
<tr>
<td>INTF</td>
<td>0x07</td>
<td>0x00</td>
<td>0000 0000</td>
</tr>
<tr>
<td>INTCAP</td>
<td>0x08</td>
<td>0x00</td>
<td>0000 0000</td>
</tr>
<tr>
<td>GPIO</td>
<td>0x09</td>
<td>0x00</td>
<td>0000 0000</td>
</tr>
<tr>
<td>OLAT</td>
<td>0x0A</td>
<td>0x00</td>
<td>0000 0000</td>
</tr>
</tbody>
</table>
<p>We also ran into the issue with the interrupts during the microcontrollers course. Where we did not get the interrupts to work.</p>
<p>During the implementation for the radio communication, we did not get any communication with the radios via the STM. We tried example code, tried different radios we had some new ones laying around. All with no luck we know the radios were in working condition since we tested them with an Arduino before and the communication worked there. We decided to keep working on this while we started work on the other assignment. This so if we get it working on the other assignment, we could use this knowledge to fix the problems we were facing here. </p>
<p>In the end we did not  succseed in getting te communication working between the two devices.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a class="md-footer__link md-footer__link--prev" href="../theory/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Vorige
              </span>
              Theory
            </div>
</div>
</a>
<a class="md-footer__link md-footer__link--next" href="../per-app/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Volgende
              </span>
              PER app
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
            Copyright © 2021 Ruben Smit, Willem Dekker
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
 ... <a class="link--pdf-download" download href="../pdf/Wireless-communication-Willem-Dekker-Ruben-Smit.pdf" title="PDF">download PDF</a></div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Kopi\u00ebren naar klembord", "clipboard.copied": "Gekopieerd naar klembord", "search.config.lang": "nl", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Zoeken", "search.result.placeholder": "Typ om te beginnen met zoeken", "search.result.none": "Geen overeenkomende documenten", "search.result.one": "1 overeenkomende document", "search.result.other": "# overeenkomende documenten", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
<script src="../assets/javascripts/bundle.d892486b.min.js"></script>
</body>
</html>